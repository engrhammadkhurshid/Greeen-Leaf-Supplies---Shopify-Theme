{{ 'gls-blog.css' | asset_url | stylesheet_tag }}

{%- style -%}
  .section-{{ section.id }}-padding {
    padding-top: {{ section.settings.padding_top | times: 0.75 | round: 0 }}px;
    padding-bottom: {{ section.settings.padding_bottom | times: 0.75 | round: 0 }}px;
  }

  @media screen and (min-width: 750px) {
    .section-{{ section.id }}-padding {
      padding-top: {{ section.settings.padding_top }}px;
      padding-bottom: {{ section.settings.padding_bottom }}px;
    }
  }

  /* Custom Colors & Typography */
  #shopify-section-{{ section.id }} .gls-blog-hero__title {
    color: {{ section.settings.hero_text_color }};
    font-size: {{ section.settings.hero_title_size }}px;
  }
  #shopify-section-{{ section.id }} .gls-blog-hero__tagline {
    color: {{ section.settings.hero_text_color }};
    font-size: {{ section.settings.hero_tagline_size }}px;
  }
  
  #shopify-section-{{ section.id }} .gls-blog-sidebar {
    background-color: {{ section.settings.sidebar_bg_color }};
  }
  #shopify-section-{{ section.id }} .gls-blog-sidebar__title {
    color: {{ section.settings.sidebar_title_color }};
    font-size: {{ section.settings.sidebar_title_size }}px;
  }
  
  #shopify-section-{{ section.id }} .gls-article-card__title {
    font-size: {{ section.settings.article_title_size }}px;
    color: {{ section.settings.article_title_color }};
  }
  #shopify-section-{{ section.id }} .gls-article-card__button {
    background-color: {{ section.settings.button_bg_color }};
    color: {{ section.settings.button_text_color }};
  }
  #shopify-section-{{ section.id }} .gls-article-card__button:hover {
    background-color: {{ section.settings.button_bg_color | color_darken: 10 }};
  }
{%- endstyle -%}

<div class="gls-blog-page section-{{ section.id }}-padding">
  
  <!-- Hero Section -->
  <div class="gls-blog-hero" style="background-image: url('{% if section.settings.image != blank %}{{ section.settings.image | image_url: width: 2000 }}{% else %}{{ 'lifestyle-1' | placeholder_svg_tag }}{% endif %}');">
    <div class="gls-blog-hero__content">
      <h1 class="gls-blog-hero__title">
        {% if section.settings.title != blank %}
          {{ section.settings.title }}
        {% else %}
          {{ blog.title }}
        {% endif %}
      </h1>
      {% if section.settings.tagline != blank %}
        <p class="gls-blog-hero__tagline">{{ section.settings.tagline }}</p>
      {% endif %}
    </div>
  </div>

  <div class="gls-blog-container">
    
    <!-- Sidebar -->
    <aside class="gls-blog-sidebar">
      {% if section.settings.show_search %}
        <div class="gls-blog-sidebar__section">
          <h3 class="gls-blog-sidebar__title">Search</h3>
          <form action="{{ routes.search_url }}" method="get" class="gls-blog-search">
            <input type="hidden" name="type" value="article">
            <input type="text" name="q" placeholder="Search articles..." value="{{ search.terms | escape }}">
            <button type="submit">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="11" cy="11" r="8"></circle>
                <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
              </svg>
            </button>
          </form>
        </div>
      {% endif %}

      {% if section.settings.show_categories %}
        <div class="gls-blog-sidebar__section">
          <h3 class="gls-blog-sidebar__title">Categories</h3>
          <ul class="gls-blog-categories-list">
            <li>
              <a href="{{ blog.url }}" class="{% unless current_tags %}active{% endunless %}">
                All Posts
                <span>{{ blog.articles_count }}</span>
              </a>
            </li>
            {% for tag in blog.all_tags %}
              <li>
                <a href="{{ blog.url }}/tagged/{{ tag | handle }}" class="{% if current_tags contains tag %}active{% endif %}">
                  {{ tag }}
                </a>
              </li>
            {% endfor %}
          </ul>
        </div>
      {% endif %}
    </aside>

    <!-- Main Content -->
    <div class="gls-blog-main">
      
      <!-- Featured Categories Grid -->
      {% if section.blocks.size > 0 %}
        <div class="gls-blog-featured-cats">
          {% for block in section.blocks %}
            {% if block.type == 'category' %}
              <a href="{{ blog.url }}/tagged/{{ block.settings.tag | handle }}" class="gls-blog-cat-card" {{ block.shopify_attributes }}>
                {% if block.settings.image != blank %}
                  <img src="{{ block.settings.image | image_url: width: 400 }}" alt="{{ block.settings.tag }}" loading="lazy">
                {% else %}
                  {{ 'collection-1' | placeholder_svg_tag }}
                {% endif %}
                <div class="gls-blog-cat-card__overlay"></div>
                <span class="gls-blog-cat-card__title">{{ block.settings.tag }}</span>
              </a>
            {% endif %}
          {% endfor %}
        </div>
      {% endif %}

      <!-- Blog Posts Grid -->
      {% paginate blog.articles by section.settings.posts_per_page %}
        <div class="gls-blog-grid">
          {% for article in blog.articles %}
            <article class="gls-article-card">
              <a href="{{ article.url }}" class="gls-article-card__image-wrapper">
                {% if article.image %}
                  <img 
                    src="{{ article.image | image_url: width: 600 }}" 
                    alt="{{ article.image.alt | escape }}" 
                    class="gls-article-card__image"
                    loading="lazy"
                  >
                {% else %}
                  {{ 'image' | placeholder_svg_tag: 'gls-article-card__image' }}
                {% endif %}
              </a>
              <div class="gls-article-card__content">
                <div class="gls-article-card__meta">
                  {{ article.published_at | time_tag: format: 'date' }}
                  {% if article.tags.size > 0 %}
                    â€¢ {{ article.tags.first }}
                  {% endif %}
                </div>
                <h2 class="gls-article-card__title">
                  <a href="{{ article.url }}">{{ article.title }}</a>
                </h2>
                <div class="gls-article-card__excerpt">
                  {% if article.excerpt.size > 0 %}
                    {{ article.excerpt | strip_html | truncatewords: 20 }}
                  {% else %}
                    {{ article.content | strip_html | truncatewords: 20 }}
                  {% endif %}
                </div>
                <a href="{{ article.url }}" class="gls-article-card__button">
                  Read Article
                </a>
              </div>
            </article>
          {% endfor %}
        </div>

        {% if paginate.pages > 1 %}
          <div class="gls-pagination">
            {{ paginate | default_pagination }}
          </div>
        {% endif %}
      {% endpaginate %}

    </div>
  </div>
</div>

{% schema %}
{
  "name": "Blog Page",
  "settings": [
    {
      "type": "header",
      "content": "Hero Section"
    },
    {
      "type": "image_picker",
      "id": "image",
      "label": "Hero Image"
    },
    {
      "type": "text",
      "id": "title",
      "label": "Custom Title",
      "info": "Leave blank to use default blog title"
    },
    {
      "type": "text",
      "id": "tagline",
      "label": "Tagline",
      "default": "Explore our latest news, tips, and updates."
    },
    {
      "type": "color",
      "id": "hero_text_color",
      "label": "Hero Text Color",
      "default": "#ffffff"
    },
    {
      "type": "range",
      "id": "hero_title_size",
      "min": 24,
      "max": 72,
      "step": 2,
      "unit": "px",
      "label": "Hero Title Size",
      "default": 56
    },
    {
      "type": "range",
      "id": "hero_tagline_size",
      "min": 14,
      "max": 32,
      "step": 1,
      "unit": "px",
      "label": "Hero Tagline Size",
      "default": 18
    },
    {
      "type": "header",
      "content": "Sidebar Settings"
    },
    {
      "type": "checkbox",
      "id": "show_search",
      "label": "Show Search Bar",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_categories",
      "label": "Show Categories List",
      "default": true
    },
    {
      "type": "color",
      "id": "sidebar_bg_color",
      "label": "Sidebar Background",
      "default": "#ffffff"
    },
    {
      "type": "color",
      "id": "sidebar_title_color",
      "label": "Sidebar Title Color",
      "default": "#333333"
    },
    {
      "type": "range",
      "id": "sidebar_title_size",
      "min": 14,
      "max": 32,
      "step": 1,
      "unit": "px",
      "label": "Sidebar Title Size",
      "default": 18
    },
    {
      "type": "header",
      "content": "Article Card Settings"
    },
    {
      "type": "color",
      "id": "article_title_color",
      "label": "Article Title Color",
      "default": "#1a1a1a"
    },
    {
      "type": "range",
      "id": "article_title_size",
      "min": 16,
      "max": 40,
      "step": 1,
      "unit": "px",
      "label": "Article Title Size",
      "default": 22
    },
    {
      "type": "color",
      "id": "button_bg_color",
      "label": "Button Background",
      "default": "#7AAE5C"
    },
    {
      "type": "color",
      "id": "button_text_color",
      "label": "Button Text Color",
      "default": "#ffffff"
    },
    {
      "type": "header",
      "content": "Grid Settings"
    },
    {
      "type": "range",
      "id": "posts_per_page",
      "min": 3,
      "max": 24,
      "step": 3,
      "default": 9,
      "label": "Posts per page"
    },
    {
      "type": "header",
      "content": "Padding"
    },
    {
      "type": "range",
      "id": "padding_top",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "Top Padding",
      "default": 0
    },
    {
      "type": "range",
      "id": "padding_bottom",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "Bottom Padding",
      "default": 36
    }
  ],
  "blocks": [
    {
      "type": "category",
      "name": "Featured Category",
      "settings": [
        {
          "type": "text",
          "id": "tag",
          "label": "Tag Name",
          "info": "Must match a blog tag exactly"
        },
        {
          "type": "image_picker",
          "id": "image",
          "label": "Category Image"
        }
      ]
    }
  ]
}
{% endschema %}
